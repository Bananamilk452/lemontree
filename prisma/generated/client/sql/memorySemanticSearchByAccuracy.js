
/* !!! This is code generated by Prisma. Do not edit directly. !!!
/* eslint-disable */
"use strict"
const { makeTypedQueryFactory: $mkFactory } = require("../runtime/library")
exports.memorySemanticSearchByAccuracy = /*#__PURE__*/ $mkFactory("\nWITH\nuser_memories AS (\nSELECT memory.*, diary.date from memory\nJOIN diary ON diary.id = memory.\"diaryId\"\nWHERE memory.\"userId\" = $1\n),\nmemory_embeddings AS (\nSELECT * from embedding\nWHERE \"memoryId\" IN (SELECT id FROM user_memories)\n),\nall_similarities AS (\nSELECT\nm.*,\ne.vector,\ne.\"memoryId\",\n1 - (e.vector <=> $2::vector) AS cosine_similarity\nFROM\nuser_memories m\nJOIN\nmemory_embeddings e ON e.\"memoryId\" = m.id\n),\nmax_similarities AS (\nSELECT\n\"memoryId\",\nMAX(cosine_similarity) AS max_cosine_similarity\nFROM\nall_similarities\nGROUP BY\n\"memoryId\"\n),\nordered_results AS (\nSELECT\na.id,\na.content,\na.\"createdAt\",\na.\"updatedAt\",\na.\"userId\",\na.\"diaryId\",\na.date,\na.cosine_similarity AS score,\nCOUNT(*) OVER() as total\nFROM\nall_similarities a\nJOIN\nmax_similarities m ON a.\"memoryId\" = m.\"memoryId\" AND a.cosine_similarity = m.max_cosine_similarity\nORDER BY\na.cosine_similarity DESC\n)\nSELECT *\nFROM ordered_results\nLIMIT $3 OFFSET $4;")
